#!/bin/bash

# Specify the input file containing service names
input_file="service_versions.txt"

# Specify the output directory
output_directory="exploit_reports"

# Create the output directory if it doesn't exist
mkdir -p "$output_directory"

# Function to fetch exploits for a given service
fetch_exploits() {
    local service="$1"
    local search_query="https://github.com/rapid7/metasploit-framework/search?q=${service}+type%3Aexploit"
    local exploits=$(curl -s "$search_query" | grep -oP 'class="text-bold">\K[^<]+')
    echo "$exploits"
}

# Read services from the input file
services=($(< "$input_file"))

# Iterate through services and fetch exploits
for service in "${services[@]}"; do
    exploits=$(fetch_exploits "$service")
    output_file="$output_directory/${service//\//-}_exploits.txt"
    echo "Exploits for $service:" > "$output_file"
    echo "$exploits" | sed 's/^/- /' >> "$output_file"
    echo "Exploits saved in '$output_file'."
    echo
done
